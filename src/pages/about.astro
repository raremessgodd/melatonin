---
// src/pages/about.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import aboutCss from '../styles/components/about.css?url';
import { FEATURE_ABOUT_PAGE } from '../config/featureFlags';
import { getEntry, getCollection } from 'astro:content';

const meta = await getEntry('pages', 'about');
const { title, description, activePage, bgImage, ogImage, bodyClass } = meta.data;

const rawSlides = await getCollection('about');
const slides = rawSlides.sort((a, b) => a.data.order - b.data.order).map((s) => s.data);
---

<BaseLayout
  title={title}
  description={description}
  pageKey={FEATURE_ABOUT_PAGE ? 'about' : 'wip'}
  activePage={activePage}
  bgImage={bgImage}
  ogImage={ogImage}
  bodyClass={FEATURE_ABOUT_PAGE ? bodyClass : 'wip-page'}
>
  {FEATURE_ABOUT_PAGE ? (
    <>
      <link slot="styles" rel="stylesheet" href={aboutCss} />
      <section class="photo-stack-section" data-photo-stack>
        <div class="photo-stack__sticky">
          {slides.map((slide) => (
            <div class="photo-stack__slide">
              <img
                class="photo-stack__img"
                src={slide.image}
                alt={slide.alt ?? ''}
                loading={slide.loading ?? 'lazy'}
              />
              <div class="photo-stack__overlay" aria-hidden="true"></div>
              <div class="photo-stack__caption">
                <p class="photo-stack__label">{slide.label}</p>
                <h2 class="photo-stack__title">{slide.title}</h2>
                <p class="photo-stack__text">{slide.text}</p>
              </div>
            </div>
          ))}
        </div>
      </section>
      <main id="content"></main>
    </>
  ) : (
    <div class="terminal-fullscreen" aria-label="Work in progress" role="status">
      <div class="terminal-content" id="terminalContent"></div>
    </div>
  )}
</BaseLayout>

